/* ZD */
YUI.namespace("Y.DateCascade"),YUI.add("datecascade",function(a){var b=a.Lang,c=(a.Node,a.Attribute),d=a.Base;a.DateCascade=function(){a.DateCascade.superclass.constructor.apply(this,arguments)},a.DateCascade._instances={},a.DateCascade.NAME="datecascade",a.DateCascade.ATTRS={id:{value:"dc"},dateStart:{value:new Date("1900/01/01"),setter:function(a){var d=c.INVALID_VALUE;return a&&(b.isDate(a)?d=a:b.isDate(new Date(a))&&(d=new Date(a))),d}},dateEnd:{value:new Date,setter:function(a){var d=c.INVALID_VALUE;return a&&(b.isDate(a)?d=a:b.isDate(new Date(a))&&(d=new Date(a))),d}},dateDefault:{value:null,setter:function(a){var d=c.INVALID_VALUE;return a&&(b.isDate(a)?d=a:b.isDate(new Date(a))&&(d=new Date(a))),d}},date:{value:null,setter:function(a){return a}},year:{value:null,setter:function(a){return a},getter:function(a){return a?parseInt(a,10):null}},month:{value:null,setter:function(a){return a},getter:function(a){return a?parseInt(a,10):null}},day:{value:null,setter:function(a){return a},getter:function(a){return a?parseInt(a,10):null}}};var e={initializer:function(){var b=this,c=b.get("id");b._Y=a.one("#"+c+"_selectyear"),b._M=a.one("#"+c+"_selectmonth"),b._D=a.one("#"+c+"_selectday"),b._events=[],a.DateCascade._instances[c]=b,b._Y&&b._M&&b._D&&(b._dayInMonth=[31,28,31,30,31,30,31,31,30,31,30,31],b.render(),b._bindEvent())},destructor:function(){for(var b=this;b._events.length;)b._events.pop().detach();delete a.DateCascade._instances[b.get("id")]},_parseParam:function(a){var b=this;a=a||{};for(var c in a)a.hasOwnProperty(c)&&b.set(c,a[c])},_bindEvent:function(){var a=this;a._events=a._events.concat([a._Y.on("change",function(){a.set("year",a._Y._node.value),a.setNewMonth(parseInt(a._M.get("value"),10))}),a._M.on("change",function(){a.set("month",a._M._node.value),a.setNewDay(parseInt(a._D.get("value"),10))}),a._D.on("change",function(){a.set("day",a._D._node.value),a.set("date",a.getSelectedDate())})])},render:function(a){var b=this;b._parseParam(a);var c=b.get("dateStart"),d=b.get("dateEnd"),e=b.get("dateDefault"),f=b._Y.get("value"),g=b._M.get("value"),h=b._D.get("value");if(b._dsYear=c.getFullYear(),b._dsMonth=c.getMonth()+1,b._dsDay=c.getDate(),b._deYear=d.getFullYear(),b._deMonth=d.getMonth()+1,b._deDay=d.getDate(),e&&b._inDateRange(e)){var i=e.getFullYear()+"",j=(e.getMonth()+1<10?"0":"")+(e.getMonth()+1),k=(e.getDate()<10?"0":"")+e.getDate();b.set("year",i),b.set("month",j),b.set("day",k),b.set("date",i+"-"+j+k),b.setNewDate(e)}else f||g||h?b.setNewDate(f,g,h):b.reset();return this},_inDateRange:function(a){var b=this,a=b._checkDate(a);if(a){var c=1e4*b._dsYear+100*b._dsMonth+b._dsDay,d=1e4*b._deYear+100*b._deMonth+b._deDay,a=1e4*a.getFullYear()+100*(a.getMonth+1)+a.getDate();return c>a||a>d?!1:!0}},_isLeapYear:function(a){return a=parseInt(a,10),0===a%4&&0!==a%100||0===a%400},_checkDate:function(a){var c=a&&(b.isDate(a)&&a||b.isDate(new Date(a))&&new Date(a));return c&&"Invalid Date"!==c.toString()&&!isNaN(c)&&c},getSelectedDate:function(){var a=this,b=a._Y.get("value"),c=a._M.get("value"),d=a._D.get("value");return b&&c&&d?b+"-"+c+"-"+d:""},setNewDate:function(a){var c,d=this;if(c=d._checkDate(a))var e=c.getFullYear(),f=c.getMonth()+1,g=c.getDate();else{if(!b.isObject(a))return this;var e=a.year||null,f=a.month||null,g=a.day||null}return null!=e&&d.setNewYear(e,null!=f?!1:!0),null!=f&&d.setNewMonth(f,null!=g?!1:!0),null!=g&&d.setNewDay(g),this},setNewYear:function(a,b){var c=this,d=parseInt(c._M.get("value"),10);return c.renderYear(),a!=c._Y._node.value&&(c._Y._node.value=a,(c._Y._node.selectedIndex<0||c._Y._node.value!=a)&&(c._Y._node.options[0].selected=!0),c.set("year",c._Y._node.value)),b===!1?(c.set("date",c.getSelectedDate()),this):(c.setNewMonth(d),this)},setNewMonth:function(a,b){var c=this,d=parseInt(c._Y.get("value"),10),e=parseInt(c._D.get("value"),10),a=(parseInt(a,10)<10?"0":"")+parseInt(a,10);return c.renderMonth(d),a!=c._M._node.value&&(c._M._node.value=a,(c._M._node.selectedIndex<0||c._M._node.value!=a)&&(c._M._node.options[0].selected=!0),c.set("month",c._M._node.value)),b===!1?(c.set("date",c.getSelectedDate()),this):(c.setNewDay(e),this)},setNewDay:function(a){var b=this,c=parseInt(b._Y.get("value"),10),d=parseInt(b._M.get("value"),10),a=(parseInt(a,10)<10?"0":"")+parseInt(a,10);return b.renderDay(c,d),a!=b._D._node.value&&(b._D._node.value=a,(b._D._node.selectedIndex<0||b._D._node.value!=a)&&(b._D._node.options[0].selected=!0),b.set("day",b._D._node.value)),b.set("date",b.getSelectedDate()),this},renderYear:function(){var a=this,b=a._getYearRange(),c=a._Y._node.options,d=c.length;if(d>1&&c[1].value==b.max&&c[d-1].value==b.min)return this;for(a._Y._node.innerHTML="",a._Y._node.add(new Option("-",""),void 0),i=b.max;i>=b.min;i--)a._Y._node.add(new Option(i,i),void 0);return this},renderMonth:function(a){var b,c=this,d=c._getMonthRange(a),e=c._M._node.options,f=e.length;if(f>1&&e[1].value==d.min&&e[f-1].value==d.max)return this;for(c._M._node.innerHTML="",c._M._node.add(new Option("-",""),void 0),i=d.min;i<=d.max;i++)b=i>=10?i:"0"+i,c._M._node.add(new Option(b,b),void 0);return this},renderDay:function(a,b){var c,d=this,e=d._getDayRange(a,b),f=d._D._node.options,g=f.length;if(g>1&&f[1].value==e.min&&f[g-1].value==e.max)return this;for(d._D._node.innerHTML="",d._D._node.add(new Option("-",""),void 0),i=e.min;i<=e.max;i++)c=i>=10?i:"0"+i,d._D._node.add(new Option(c,c),void 0);return this},reset:function(){var a=this;return a.renderYear().renderMonth().renderDay(),a._Y._node.options[0].selected=!0,a._M._node.options[0].selected=!0,a._D._node.options[0].selected=!0,a.set("date",""),this},_getYearRange:function(){var a=this;return{min:a._dsYear,max:a._deYear}},_getMonthRange:function(a){var b=this,c=1,d=12;return a==b._dsYear&&(c=b._dsMonth),a==b._deYear&&(d=b._deMonth),{min:c,max:d}},_getDayRange:function(a,b){var c=this,d=1,e=31;return b&&(e=2!=b?c._dayInMonth[b-1]:c._isLeapYear(a)?29:28,a==c._dsYear&&b==c._dsMonth&&(d=c._dsDay),a==c._deYear&&b==c._deMonth&&(e=c._deDay)),{min:d,max:e}}};a.extend(a.DateCascade,d,e),YUI.namespace("Y.DateCascade.Input"),a.DateCascade.Input=function(){a.DateCascade.Input.superclass.constructor.apply(this,arguments)},a.DateCascade.Input.NAME="datecascade-input",a.extend(a.DateCascade.Input,a.DateCascade,{initializer:function(){var b=this,c=b.get("id");b._buildSelector(),b._Y=a.one("#"+c+"_selectyear"),b._M=a.one("#"+c+"_selectmonth"),b._D=a.one("#"+c+"_selectday"),b._events=[],b._Y&&b._M&&b._D&&(b._dayInMonth=[31,28,31,30,31,30,31,31,30,31,30,31],b.render(),b._bindEvent())},_buildSelector:function(){var b=this,c=b.get("id");(b.input=a.one("#"+c))&&(b.box&&b.box.remove(),b.input.setStyle("display","none"),b.box=a.Node.create('<span class="datecascade"><select id="'+c+'_selectyear" class="dc-year"><option value="">-</option></select> 年 <select id="'+c+'_selectmonth" class="dc-month"><option value="">-</option></select> 月 <select id="'+c+'_selectday" class="dc-day"><option value="">-</option></select> 日 </span>'),b.input.insert(b.box,"after"))},_bindEvent:function(){var a=this;a._events=a._events.concat([a._Y.on("change",function(){a.set("year",a._Y._node.value),a.setNewMonth(parseInt(a._M.get("value"),10))}),a._M.on("change",function(){a.set("month",a._M._node.value),a.setNewDay(parseInt(a._D.get("value"),10))}),a._D.on("change",function(){a.set("day",a._D._node.value),a.set("date",a.getSelectedDate())}),a.after("dateChange",function(){a.updateDate()})])},render:function(a){var b=this;b._parseParam(a);var c=b.get("dateStart"),d=b.get("dateEnd"),e=b.get("dateDefault"),f=b._Y.get("value"),g=b._M.get("value"),h=b._D.get("value");if(e||(b.set("dateDefault",b.input.get("value").replace(/-/g,"/")),e=b.get("dateDefault")),b._dsYear=c.getFullYear(),b._dsMonth=c.getMonth()+1,b._dsDay=c.getDate(),b._deYear=d.getFullYear(),b._deMonth=d.getMonth()+1,b._deDay=d.getDate(),e&&b._inDateRange(e)){var i=e.getFullYear()+"",j=(e.getMonth()+1<10?"0":"")+(e.getMonth()+1),k=(e.getDate()<10?"0":"")+e.getDate();b.set("year",i),b.set("month",j),b.set("day",k),b.set("date",i+"-"+j+k),b.setNewDate(e)}else f||g||h?b.setNewDate(f,g,h):(b.renderYear().renderMonth().renderDay(),b._Y._node.options[0].selected=!0,b._M._node.options[0].selected=!0,b._D._node.options[0].selected=!0);return this},reset:function(){var a=this;return a.renderYear().renderMonth().renderDay(),a._Y._node.options[0].selected=!0,a._M._node.options[0].selected=!0,a._D._node.options[0].selected=!0,a.set("date",""),a.input.set("value",""),this},updateDate:function(){var a=this,b=a.getSelectedDate();return a.input.set("value",b),this}})},"2.0.0",{requires:["node","base"]});