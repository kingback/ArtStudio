/* ZD */
YUI.add("waterfall",function(a){function b(a){return a&&a.toString&&a.toString()||""}a.Waterfall=a.Base.create("waterfall",a.Base,[],{initializer:function(){this._listTag=this.get("listTag"),this._itemTag=this.get("itemTag"),this._formatter=this.get("formatter")||a.Waterfall.DEF_FORMATTER,this._delay=this.get("delay"),this._queue=new a.Queue,this.adding=!1,this.publish("add",{defaultFn:this._defAddFn}),this.publish("done")},render:function(){return this._container=this.get("container"),this._container.addClass(a.Waterfall.CON_CLASS),this.initList(),this.add(this.get("data")),this},initList:function(){var a=this.get("col"),b=a-1,c=0;for(this._lists=[];a>c;c++)this.addList(c===b);this._shortList=this._lists[0]},addList:function(b){var c=this._container,d=a.one(document.createElement(this._listTag));return d.addClass(a.Waterfall.LIST_CLASS),b&&d.addClass(a.Waterfall.LIST_CLASS_LAST),c.append(d),this._lists.push(d),d},addItem:function(a){var b=this.getShortList(),c=this.createItem(a);return b.node.append(c),this.fire("add",{index:b.index,list:b.node,item:c}),c},createItem:function(b){var c=a.one(document.createElement(this._itemTag)),d=this._formatter(b);return c.addClass(a.Waterfall.ITEM_CLASS),c.append(d),c},getShortList:function(){for(var a,b,c=this._lists,d=c.length,e=0,f=0,g=-1;d>e;e++)a=c[e].get("offsetHeight"),(!e||g>a)&&(g=a,b=c[e],f=e);return this._shortList=b,{index:f,node:b}},add:function(b){b&&(a.Lang.isArray(b)||(b=[b]),this._queue.add.apply(this._queue,b),this.adding||this.next())},next:function(){var a=this;return this._queue.size()?(this.adding=!0,setTimeout(function(){a.addItem(a._queue.next())},this._delay)):(this.adding=!1,this.fire("done")),this},_defAddFn:function(){this.next()}},{ATTRS:{container:{setter:a.one},formatter:{},col:{value:3},listTag:{value:"ul"},itemTag:{value:"li"},delay:{value:1},data:{}},DEF_FORMATTER:b,CON_CLASS:"waterfall",LIST_CLASS:"waterfall-list",LIST_CLASS_LAST:"waterfall-list-last",ITEM_CLASS:"waterfall-item"})},"0.0.1",{requires:["node","event","base"]});