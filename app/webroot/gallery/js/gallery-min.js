/* ZD */
YUI.add("gallery",function(a){function b(a){for(var b,c=location.hash.substring(1),d=c.split("&"),e={};d.length;)b=d.shift().split("="),b[0]&&(e[b[0]]=b[1]||"");return a?e[a]||"":e}function c(a,c){var d,e=b(),f=[],g="";e[a]=c||0===c?c:"";for(d in e)e.hasOwnProperty(d)&&f.push(d+"="+e[d]);g+=f.join("&"),location.hash=g}var d={id:"a9c1671343227b4e40a68c9d1e213189",desc:"虎牙",title:"虎牙",cover:{large:"feacf24bbac61ba840b3d8824dbd955a-70-81.gif",small:"feacf24bbac61ba840b3d8824dbd955a-70-81.gif"},image_num:14,images:[{id:"1",small:"http://106.186.25.82/gridfs/b03a6770fe2aabeedf9312df70560642-584-820.png",large:"http://106.186.25.82/gridfs/b03a6770fe2aabeedf9312df70560642-584-820.png"},{id:"2",small:"http://106.186.25.82/gridfs/74931bdbd8774341b26d9c6c030fc41b-587-820.png",large:"http://106.186.25.82/gridfs/74931bdbd8774341b26d9c6c030fc41b-587-820.png"},{id:"3",small:"http://106.186.25.82/gridfs/5201733f84896ec608b40849b9cfcec5-591-820.png",large:"http://106.186.25.82/gridfs/5201733f84896ec608b40849b9cfcec5-591-820.png"},{id:"4",small:"http://106.186.25.82/gridfs/c5a24583f379caab3fc1a0ebd3a4bde8-583-820.png",large:"http://106.186.25.82/gridfs/c5a24583f379caab3fc1a0ebd3a4bde8-583-820.png"},{id:"5",small:"http://106.186.25.82/gridfs/444ae078389eaa444805fc082f562478-584-820.png",large:"http://106.186.25.82/gridfs/444ae078389eaa444805fc082f562478-584-820.png"},{id:"6",small:"http://106.186.25.82/gridfs/f9180fe7dcd24c6bf7e13a5ed562105a-583-820.png",large:"http://106.186.25.82/gridfs/f9180fe7dcd24c6bf7e13a5ed562105a-583-820.png"},{id:"7",small:"http://106.186.25.82/gridfs/90917713d3c8b21cbfc8f45e8cf77944-520-350.jpeg",large:"http://106.186.25.82/gridfs/90917713d3c8b21cbfc8f45e8cf77944-520-350.jpeg"},{id:"8",small:"http://106.186.25.82/gridfs/3a8e1bda303e345a58acb390792727f3-361-336.jpeg",large:"http://106.186.25.82/gridfs/3a8e1bda303e345a58acb390792727f3-361-336.jpeg"},{id:"9",small:"http://106.186.25.82/gridfs/37ceb25a917b31cefc18c2b861512ff9-320-276.gif",large:"http://106.186.25.82/gridfs/37ceb25a917b31cefc18c2b861512ff9-320-276.gif"},{id:"10",small:"http://106.186.25.82/gridfs/51e605f75ce09b91e521a46b882a43c2-400-400.jpeg",large:"http://106.186.25.82/gridfs/51e605f75ce09b91e521a46b882a43c2-400-400.jpeg"},{id:"11",small:"http://106.186.25.82/gridfs/b4de5e031c8e7d16473a39e6cc3c1553-378-317.jpeg",large:"http://106.186.25.82/gridfs/b4de5e031c8e7d16473a39e6cc3c1553-378-317.jpeg"},{id:"12",small:"http://106.186.25.82/gridfs/35b8743808ed19b07c849cea776ac3fd-311-308.jpeg",large:"http://106.186.25.82/gridfs/35b8743808ed19b07c849cea776ac3fd-311-308.jpeg"},{id:"13",small:"http://106.186.25.82/gridfs/d1a3153643643d1470ffeff18f672198-320-480.jpeg",large:"http://106.186.25.82/gridfs/d1a3153643643d1470ffeff18f672198-320-480.jpeg"},{id:"14",small:"http://106.186.25.82/gridfs/8e730b3a07cf9693dd4c4dde4a37ce1e-609-852.png",large:"http://106.186.25.82/gridfs/8e730b3a07cf9693dd4c4dde4a37ce1e-609-852.png"}]};a.Gallery={init:function(){this.id=!1,this.data={},this.initLoading(),this.initTip(),this.bindAlbums(),this.data.huya1=a.merge(d,{id:"huya1",title:"虎牙1"}),this.data.huya2=a.merge(d,{id:"huya2",title:"虎牙2"}),this.showSelected()},initGalleria:function(b){this.galleria=new a.Galleria({source:b,zIndex:1e3,visible:!1,render:!0}),this.galleria.on("select",function(a){c("imageid",a.id)}),this.galleria.after("visibleChange",function(a){a.newVal||(c("albumid",""),c("imageid",""))})},showSelected:function(){var c=b(),d=c.albumid,e=c.imageid;a.Array.some(a.all(".album-item").getDOMNodes(),function(a){return a.getAttribute("data-albumid")===d?(this.showAlbum(d,e),!0):void 0},this)},showGalleria:function(b,d){var e=!1;this.loading.setStyle("display","none"),a.Lang.isString(b)&&(b=this.data[b],e=!0),b&&b.images&&b.images.length?(e||(this.galleria?this.galleria.set("source",b):this.initGalleria(b)),this.galleria&&(this.galleria.show(),this.galleria.showImage(d))):(this.showTip("这个相册还没有图片哦~"),c("albumid",""),c("imageid",""))},showAlbum:function(a,b){return c("albumid",a),this.hideTip(),this.id&&a===this.id&&this.data[a]?(this.showGalleria(a,b),this):(this.loading.setStyle("display","block"),this.id=a,this.getAlbumData(a,function(c){c&&(this.data[a]=c),this.id===a&&this.showGalleria(c,b)}),this)},getAlbumData:function(b,d){var e=this;this.data[b]?d&&d.call(this,this.data[b]):a.io("/mainapi/albuminfo",{method:"GET",data:{id:b},on:{complete:function(b,f){var g;try{g=a.JSON.parse(f.responseText)}catch(h){}g?(g=e.parseData(g),d&&d.call(e,g||null)):(e.loading.setStyle("display","none"),e.showTip("抱歉，相册加载失败，请稍后再试~"),c("albumid",""),c("imageid",""))}}})},parseData:function(b){return a.Array.each(b.images,function(a,c){b.images[c].small="/gridfs/"+b.images[c].small,b.images[c].large="/gridfs/"+b.images[c].large}),b},bindAlbums:function(){var b=a.one("body");b.delegate("click",this.onAlbumClick,".album-cover a",this),b.delegate("click",this.onAlbumClick,".album-show a",this)},initLoading:function(){this.loading=a.Node.create('<div class="album-loading">正在加载相册...</div>'),a.one("body").prepend(this.loading)},onAlbumClick:function(a){a.halt(),this.showAlbum(a.currentTarget.ancestor("li").getAttribute("data-albumid"))},initTip:function(){this.tip=a.Node.create('<div class="album-tip"></div>'),a.one("body").prepend(this.tip)},showTip:function(a){var b=this;clearTimeout(this.tipTimer),this.tip.setContent(a),this.tip.setStyles({left:"50%",top:"50%",marginLeft:-this.tip.get("offsetWidth")/2+"px",visibility:"visible"}),this.tipTimer=setTimeout(function(){b.hideTip()},3e3)},hideTip:function(){clearTimeout(this.tipTimer),this.tip.setContent(""),this.tip.setStyles({left:"-200%",top:"-200%",visibility:"hidden"})}},a.Gallery.init()},"0.0.1",{requires:["galleria","io","json-parse"]});