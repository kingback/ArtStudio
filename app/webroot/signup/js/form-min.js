/* ZD */
YUI.add("form",function(a){var b={name:{required:{errmsg:"请填写您的姓名"}},birthday:{required:{errmsg:"请选择正确的出生日期"}},highschool:{required:{errmsg:"请填写您所在高中"}},telephone:{required:{errmsg:"请填写您的手机号码"},regx:{rule:"telephone",errmsg:"您所填的手机号码格式不正确"}},qq:{required:{errmsg:"请填写您的QQ号码"},regx:{rule:"number",errmsg:"您所填的QQ号码格式不正确"}},email:{required:{errmsg:"请填写您的邮箱"},regx:{rule:"email",errmsg:"您所填的邮箱格式不正确"}}};a.Form={init:function(){this.domCache(),this.initDateCascade(),this.initValidator(),this.bindEvents()},domCache:function(){this.form=a.one("#s-form"),this.formNode=this.form.getDOMNode(),this.elemNodes=this.formNode.elements,this.elems=a.all(this.elemNodes),this.requiredInputs=this.form.all(".required-info .elem-txt"),this.dateSelectInput=this.form.one("#birthday"),this.uploadInput=this.form.one("#avartar-unload-ipt"),this.uploadFile=this.form.one(".avartar-file"),this.avartarImage=this.form.one(".avartar-image img")},initDateCascade:function(){this.date=new a.DateCascade({id:"f-birthday",dateStart:"1950/01/01"}),this.dateSelectInput.set("value",this.date.get("date"))},initValidator:function(){this.validator=Validator(b)},bindEvents:function(){this.form.on("submit",function(a){var b,c=this.validator.checkForm(this.formNode);a.preventDefault(),this.removeError(this.requiredInputs),c.valid?this.form.submit():(this.addError(c.ErrObj),b=this.form.one(".item-error .elem-txt"),b.hasClass("hidden")&&(b=b.ancestor("li").one("select")),b.focus())},this),this.requiredInputs.on("blur",function(a){var b=this.validator.validateElem(a.target.getDOMNode());b.valid?this.removeError(a.target):this.addError(b.ErrObj)},this),this.date.after("dateChange",function(a){this.dateSelectInput.set("value",a.newVal),a.newVal?this.removeError(this.dateSelectInput):this.addError(this.validator.validateElem(this.dateSelectInput._node).ErrObj)},this),this.uploadInput.on("change",function(a){var b,c=this,d=a.target._node.files;this.uploadFile.setContent(a.target.get("value")),d&&"undefined"!=typeof FileReader&&(b=new FileReader,b.onload=function(){c.avartarImage._node.src=this.result},b.readAsDataURL(d[0]))},this)},addError:function(b,c){var d;a.Lang.isUndefined(c)?a.Object.each(b,function(a,b){this.addError(b,a[0])},this):(b=a.one(a.Lang.isString(b)?this.elemNodes[b]:b),b&&(d=b.ancestor("li"),d.addClass("item-error"),d.one(".info").setContent(c)))},removeError:function(b){var c;b.size?b.each(function(a){this.removeError(a)},this):(b=a.one(b),b&&(c=b.ancestor("li"),c.removeClass("item-error"),b.ancestor("li").one(".info").setContent("")))}},a.Form.init()},"0.0.1",{requires:["node","validator","event-hover","querystring-parse"]});